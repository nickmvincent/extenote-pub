---
import Layout from '../layouts/Layout.astro';
import { getSiteData } from '../lib/contentLoader';
import { truncateText, formatMonthYear } from '../lib/formatters';

const data = await getSiteData();
const { personalInfo, scholarly, editorial, blogs, talks, newsCoverage } = data;

const peerReviewed = scholarly.filter(
	(item) => String(item.metadata.publication_type ?? '').toLowerCase() === 'publication'
);

// Filter for items within the last 12 months
const twelveMonthsAgo = new Date();
twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);
const isRecent = (item: { metadata: { date?: unknown } }) => {
	const date = item.metadata.date;
	if (!date) return false;
	const itemDate = new Date(date as string);
	return itemDate >= twelveMonthsAgo;
};

const summary = {
	publications: peerReviewed.filter(isRecent).slice(0, 4),
	editorial: editorial.filter(isRecent).slice(0, 3),
	blogs: blogs.filter(isRecent).slice(0, 3),
	talks: talks.filter(isRecent).slice(0, 4),
	news: newsCoverage.filter(isRecent).slice(0, 4)
};

const highlightList = Array.isArray(personalInfo.highlights) ? personalInfo.highlights : [];
const heroName = (personalInfo.title ?? 'Academic Website').split(' - ')[0];
const description =
	typeof personalInfo.quick_bio === 'string' ? personalInfo.quick_bio.slice(0, 160) : '';
const schemaPerson = {
	'@context': 'https://schema.org',
	'@type': 'Person',
	name: personalInfo.title,
	jobTitle: personalInfo.position,
	affiliation: personalInfo.university,
	email: personalInfo.email
};
const json = (value: unknown) => JSON.stringify(value).replace(/</g, '\\u003c');
const profilePic =
	typeof personalInfo.profile_pic === 'string' && personalInfo.profile_pic.length
		? (personalInfo.profile_pic as string)
		: null;

const formatSummaryDate = (value: unknown) => formatMonthYear(value) || '';

// Helper for proper list formatting: "A, B, and C"
const listSeparator = (index: number, total: number): string => {
	if (total === 1) return '';
	if (index === total - 1) return '';
	if (index === total - 2) return total === 2 ? ' and ' : ', and ';
	return ', ';
};

const getLeadAuthor = (authors: unknown): string => {
	if (Array.isArray(authors) && authors.length > 0) {
		const parts = String(authors[0]).trim().split(/\s+/);
		return parts.length ? parts[parts.length - 1] : String(authors[0]);
	}
	return heroName.split(' ').pop() ?? 'Author';
};

// Parse affiliations from YAML
type Affiliation = { name: string; url: string; role: string };
const rawAffiliations = Array.isArray(personalInfo.affiliations)
	? (personalInfo.affiliations as Affiliation[])
	: [];
const directorAffiliation = rawAffiliations.find(a => a.role === 'director');
const otherAffiliations = rawAffiliations.filter(a => a.role !== 'director');

// Social links with icons (Substack moved to featured links section)
const socialLinks = [
	{ href: personalInfo.bsky_link, label: 'Bluesky', icon: 'bluesky' },
	{ href: personalInfo.github_link, label: 'GitHub', icon: 'github' },
	{ href: personalInfo.linkedin_link, label: 'LinkedIn', icon: 'linkedin' },
	{ href: personalInfo.twitter_link, label: 'X', icon: 'x' }
].filter((link) => typeof link.href === 'string' && link.href.length);

// Paper tracker links (text only)
const paperLinks = [
	{ href: personalInfo.scholar_link, label: 'Google Scholar' },
	{ href: personalInfo.semantic_scholar_link, label: 'Semantic Scholar' },
	{ href: personalInfo.dblp_link, label: 'DBLP' }
].filter((link) => typeof link.href === 'string' && link.href.length);

// All links for the modal
const allLinks = [
	...socialLinks.map(l => ({ ...l, category: 'Social' })),
	...paperLinks.map(l => ({ ...l, category: 'Papers' }))
];
const workshopAndPreprint = scholarly.filter(
	(item) => String(item.metadata.publication_type ?? '').toLowerCase() !== 'publication'
);
// Editorial now only contains op-eds (published writing)
// Blogs are loaded separately from data-leverage-blogs

const publicationLinks = (meta: Record<string, any>) => {
	const links: { label: string; url: string }[] = [];
	if (meta.arxiv_url) links.push({ label: 'arXiv', url: meta.arxiv_url as string });
	if (meta.acm_url) links.push({ label: 'ACM DL', url: meta.acm_url as string });
	if (meta.url && !meta.arxiv_url && !meta.acm_url)
		links.push({ label: meta.url.endsWith('.pdf') ? 'PDF' : 'Link', url: meta.url as string });
	if (meta.doi) links.push({ label: 'DOI', url: `https://doi.org/${meta.doi}` });
	if (meta.code_url) links.push({ label: 'Code', url: meta.code_url as string });
	return links;
};

const publicationVenue = (meta: Record<string, any>) => {
	const venue = meta.journal ?? meta.conference ?? '';
	const year = formatMonthYear(meta.date) || '';
	return [venue, year].filter(Boolean).join(' ');
};

const buildFilterOptions = <T,>(
	items: T[],
	getLabel: (item: T) => string | undefined | null
) => {
	const map = new Map<string, { label: string; value: string; count: number }>();
	for (const item of items) {
		const label = getLabel(item);
		if (!label) continue;
		const value = label.toLowerCase();
		const entry = map.get(value);
		if (entry) {
			entry.count += 1;
		} else {
			map.set(value, { label, value, count: 1 });
		}
	}
	return Array.from(map.values()).sort((a, b) => a.label.localeCompare(b.label));
};

const talkTypes = {
	talk: 'Talk',
	'guest lecture': 'Guest Lecture',
	keynote: 'Keynote',
	panel: 'Panel',
	podcast: 'Podcast',
	'poster presentation': 'Poster Presentation'
};

const peerReviewedFilters = buildFilterOptions(
	peerReviewed,
	(item) => item.metadata.journal ?? item.metadata.conference ?? undefined
);
const workshopFilters = buildFilterOptions(
	workshopAndPreprint,
	(item) => item.metadata.journal ?? item.metadata.conference ?? undefined
);
const editorialFilters = buildFilterOptions(editorial, (item) => item.metadata.venue ?? undefined);
const talksFilters = buildFilterOptions(talks, (item) => item.metadata.location ?? undefined);
const mediaFilters = buildFilterOptions(newsCoverage, (item) => item.metadata.source ?? undefined);
---

<Layout title={`${heroName} - Academic Website`} description={description}>
	<script
		slot="head"
		type="application/ld+json"
		set:html={json(schemaPerson)}
	/>

		<header id="home" class="hero hero-manuscript">
			<button type="button" id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
				<span class="theme-icon-light">‚òÄÔ∏è</span>
				<span class="theme-icon-dark">üåô</span>
			</button>
			<div class="hero-intro">
				<div class="hero-heading">
					<div class="hero-text">
						<div class="hero-name-row">
							{profilePic && (
								<img
									src={profilePic}
									alt="Profile picture"
									class="profile-pic hero-inline-pic"
									loading="lazy"
									decoding="async"
								/>
							)}
							<h1>{heroName}</h1>
						</div>
						<p class="hero-role">
							{personalInfo.position}
							{personalInfo.department && ` ¬∑ ${personalInfo.department}`}
							{personalInfo.university && `, ${personalInfo.university}`}
						</p>
						{personalInfo.research_interests && (
							<p class="hero-research">{personalInfo.research_interests}</p>
						)}
					</div>
				</div>
				{(personalInfo.quick_bio || personalInfo.additional_background) && (
					<div class="hero-bio-block">
						<p class="hero-bio">
							{personalInfo.quick_bio}
							{personalInfo.additional_background && (
								<button type="button" class="modal-trigger bio-trigger" data-modal="bio-modal">(Longer bio)</button>
							)}
						</p>
					</div>
				)}
				{(personalInfo.email || personalInfo.cv_link || personalInfo.cv_html_link) && (
					<nav class="hero-cta" aria-label="Primary contact actions">
						{personalInfo.email && (
							<a
								class="hero-btn secondary hero-btn-small hero-btn-email"
								href={`mailto:${personalInfo.email}`}
								target="_blank"
								rel="noopener noreferrer"
							>
								{personalInfo.email}
							</a>
						)}
						{personalInfo.cv_link && (
							<a
								class="hero-btn secondary hero-btn-small"
								href={personalInfo.cv_link as string}
								target="_blank"
								rel="noopener noreferrer"
							>
								CV (PDF)
							</a>
						)}
						{personalInfo.cv_html_link && (
							<a
								class="hero-btn secondary hero-btn-small"
								href={personalInfo.cv_html_link as string}
								target="_blank"
								rel="noopener noreferrer"
							>
								CV (HTML)
							</a>
						)}
					</nav>
				)}
			</div>
		</header>

	<section id="featured-links">
		<ul class="featured-list">
			<li>
				I am based in the{' '}
				<a href={personalInfo.current_inst_link as string} target="_blank" rel="noopener noreferrer">
					{personalInfo.department}
				</a>{' '}
				at{' '}
				<a href={personalInfo.university_link as string} target="_blank" rel="noopener noreferrer">
					{personalInfo.university}
				</a>
				{directorAffiliation && (
					<>
						{' '}and direct{' '}
						<a href={directorAffiliation.url} target="_blank" rel="noopener noreferrer">
							{directorAffiliation.name}
						</a>
					</>
				)}.
				{otherAffiliations.length > 0 && (
					<>
						{' '}I am also associated with{' '}
						{otherAffiliations.map((aff, i) => (
							<>
								<a href={aff.url} target="_blank" rel="noopener noreferrer">{aff.name}</a>
								{listSeparator(i, otherAffiliations.length)}
							</>
						))}.
					</>
				)}
			</li>
			<li>
				I share content on{' '}
				{socialLinks.map((link, i) => (
					<>
						<a href={link.href as string} target="_blank" rel="noopener noreferrer">{link.label}</a>
						{listSeparator(i, socialLinks.length)}
					</>
				))}.
				My papers can be found below or via{' '}
				{paperLinks.map((link, i) => (
					<>
						<a href={link.href as string} target="_blank" rel="noopener noreferrer">{link.label}</a>
						{listSeparator(i, paperLinks.length)}
					</>
				))}.
			</li>
			<li>
				See my newsletter on Substack:{' '}
				<a href={personalInfo.blog_link as string} target="_blank" rel="noopener noreferrer">
					Data Leverage Newsletter
				</a>.
			</li>
			<li>
				See a collection of web projects{' '}
				<a href="https://shared-references.pages.dev/projects/" target="_blank" rel="noopener noreferrer">here</a>
				(e.g., the
				<a href="https://datacounterfactuals.org/" target="_blank" rel="noopener noreferrer">Data Counterfactuals explainer</a>, the
				<a href="https://exploringai.org/" target="_blank" rel="noopener noreferrer">Data Napkin math explorer</a>, and the
				<a href="https://datalicenses.org" target="_blank" rel="noopener noreferrer">Data License Catalog</a>‚Äîall now managed with{' '}
				<a href="https://nickmvincent.github.io/extenote/" target="_blank" rel="noopener noreferrer">extenote</a>).
			</li>
		</ul>
	</section>

	<section id="recent-summary">
		<h2>Recent Content</h2>
		<div class="grid">
			<div>
				<h3>Publications</h3>
				<div class="centered-summary">
					<div class="summary-item">
						{summary.publications.map((pub) => (
							<div style="margin-bottom:0.75em;">
								{truncateText(String(pub.metadata.title ?? ''), 60)}, {getLeadAuthor(pub.metadata.authors)} ...,
								{pub.metadata.journal ?? pub.metadata.conference ?? 'N/A'}, {formatSummaryDate(pub.metadata.date)}
								{pub.metadata.url && (
									<>
										 {' '}
										<a href={pub.metadata.url as string} target="_blank" rel="noopener noreferrer">
											link
										</a>
									</>
								)}
							</div>
						))}
					</div>
				</div>
			</div>
			<div>
				<h3>Writing</h3>
				<div class="centered-summary">
					<div class="summary-item">
						{summary.editorial.length > 0 && (
							<div class="summary-subsection">
								<span class="summary-label">Op-eds</span>
								{summary.editorial.map((post) => (
									<div style="margin-bottom:0.5em;">
										{truncateText(String(post.metadata.title ?? ''), 55)}, {post.metadata.venue ?? 'N/A'}
										{post.metadata.url && (
											<>
												{' '}
												<a href={post.metadata.url as string} target="_blank" rel="noopener noreferrer">
													link
												</a>
											</>
										)}
									</div>
								))}
							</div>
						)}
						{summary.blogs.length > 0 && (
							<div class="summary-subsection">
								<span class="summary-label">Blog</span>
								{summary.blogs.map((post) => (
									<div style="margin-bottom:0.5em;">
										{truncateText(String(post.metadata.title ?? ''), 55)}
										{post.metadata.url && (
											<>
												{' '}
												<a href={post.metadata.url as string} target="_blank" rel="noopener noreferrer">
													link
												</a>
											</>
										)}
									</div>
								))}
							</div>
						)}
					</div>
				</div>
			</div>
			<div>
				<h3>Talks</h3>
				<div class="centered-summary">
					<div class="summary-item">
						{summary.talks.map((talk) => (
							<div style="margin-bottom:0.75em;">
								{truncateText(String(talk.metadata.title ?? ''), 50)}, {talk.metadata.location ?? 'N/A'},
								{formatSummaryDate(talk.metadata.date)}
							</div>
						))}
					</div>
				</div>
			</div>
			<div>
				<h3>Media Coverage</h3>
				<div class="centered-summary">
					<div class="summary-item">
						{summary.news.map((item) => (
							<div style="margin-bottom:0.75em;">
								{truncateText(String(item.metadata.title ?? ''), 50)},{' '}
								{Array.isArray(item.metadata.authors) && item.metadata.authors.length
									? item.metadata.authors.join(', ')
									: '‚Äî'}
								, {item.metadata.source ?? 'N/A'}, {formatSummaryDate(item.metadata.date)}
								{item.metadata.url && (
									<>
										 {' '}
										<a href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
											link
										</a>
									</>
								)}
							</div>
						))}
					</div>
				</div>
			</div>
		</div>
	</section>

	{highlightList.length > 0 && (
		<section id="status-board">
			<div class="status-header">
				<h2>News & Notes</h2>
			</div>
			<div class="status-grid">
				{highlightList.map((highlight) => (
					<article class="status-card" set:html={highlight} />
				))}
			</div>
		</section>
	)}

	<section class="tabs">
		<nav class="section-nav">
			<a href="#publications" class="active">Publications</a>
			<a href="#writing">Editorial</a>
			<a href="#blogs">Blogs</a>
			<a href="#talks">Talks</a>
			<a href="#media">Media Coverage</a>
		</nav>

		<section id="publications" class="tab-panel is-active">
			<h2>Publications</h2>
			<p class="section-subtitle">Latest peer-reviewed work plus workshop pieces and preprints.</p>
			<div class="row">
				<div class="col">
					<h3>Peer Reviewed</h3>
					{peerReviewedFilters.length > 0 && (
						<details class="filter-panel">
							<summary>Filter by venue</summary>
							<div class="filter-chips" data-filter-group="peer-reviewed">
								<button type="button" class="chip active" data-filter-value="all">
									All ({peerReviewed.length})
								</button>
								{peerReviewedFilters.map((option) => (
									<button type="button" class="chip" data-filter-value={option.value}>
										{option.label} ({option.count})
									</button>
								))}
							</div>
						</details>
					)}
					<ul class="entry-list" data-filter-target="peer-reviewed">
						{peerReviewed.map((item) => (
							<li
								class="entry"
								data-filter-value={(
									item.metadata.journal ??
									item.metadata.conference ??
									'other'
								).toLowerCase()}
							>
								<h3>{item.metadata.title}</h3>
								<p>
									{Array.isArray(item.metadata.authors) ? item.metadata.authors.join(', ') : personalInfo.title}
									<br />
									{publicationVenue(item.metadata)}
								</p>
								{publicationLinks(item.metadata).length > 0 && (
									<p class="entry-links">
										{publicationLinks(item.metadata).map((link) => (
											<a class="chip-link" href={link.url} target="_blank" rel="noopener noreferrer">
												{link.label}
											</a>
										))}
									</p>
								)}
							</li>
						))}
					</ul>
				</div>
				<div class="col">
					<h3>Workshop / Pre-print</h3>
					{workshopFilters.length > 0 && (
						<details class="filter-panel">
							<summary>Filter by venue</summary>
							<div class="filter-chips" data-filter-group="workshop">
								<button type="button" class="chip active" data-filter-value="all">
									All ({workshopAndPreprint.length})
								</button>
								{workshopFilters.map((option) => (
									<button type="button" class="chip" data-filter-value={option.value}>
										{option.label} ({option.count})
									</button>
								))}
							</div>
						</details>
					)}
					<ul class="entry-list" data-filter-target="workshop">
						{workshopAndPreprint.map((item) => (
							<li
								class="entry"
								data-filter-value={(
									item.metadata.journal ??
									item.metadata.conference ??
									'other'
								).toLowerCase()}
							>
								<h3>{item.metadata.title}</h3>
								<p>
									{Array.isArray(item.metadata.authors) ? item.metadata.authors.join(', ') : personalInfo.title}
									<br />
									{publicationVenue(item.metadata)}
								</p>
								{item.metadata.url && (
									<p class="entry-links">
										<a class="chip-link" href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
											link
										</a>
									</p>
								)}
							</li>
						))}
					</ul>
				</div>
			</div>
		</section>

		<section id="writing" class="tab-panel">
			<h2>Editorial</h2>
			<p class="section-subtitle">Op-eds, essays, and commentary published in external venues.</p>
			{editorialFilters.length > 0 && (
				<details class="filter-panel">
					<summary>Filter by venue</summary>
					<div class="filter-chips" data-filter-group="editorial-published">
						<button type="button" class="chip active" data-filter-value="all">
							All ({editorial.length})
						</button>
						{editorialFilters.map((option) => (
							<button type="button" class="chip" data-filter-value={option.value}>
								{option.label} ({option.count})
							</button>
						))}
					</div>
				</details>
			)}
			<ul class="entry-list" data-filter-target="editorial-published">
				{editorial.map((item) => (
					<li
						class="entry"
						data-filter-value={(item.metadata.venue ?? 'other').toString().toLowerCase()}
					>
						<h3>{item.metadata.title}</h3>
						<p>
							{formatSummaryDate(item.metadata.date)} ‚Äî {item.metadata.venue}
							{item.metadata.url && (
								<span class="entry-links">
									<a class="chip-link" href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
										link
									</a>
								</span>
							)}
						</p>
					</li>
				))}
			</ul>
		</section>

		<section id="blogs" class="tab-panel">
			<h2>Blog</h2>
			<p class="section-subtitle">
				{blogs.length} posts on the Data Leverage Newsletter.
				{personalInfo.blog_link && (
					<a href={personalInfo.blog_link as string} target="_blank" rel="noopener noreferrer">
						View on Substack
					</a>
				)}
			</p>
			<ul class="entry-list blog-compact">
				{blogs.slice(0, 15).map((item) => (
					<li class="entry-compact">
						<a href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
							{item.metadata.title}
						</a>
						<span class="entry-meta">{formatSummaryDate(item.metadata.date)}</span>
					</li>
				))}
			</ul>
			{blogs.length > 15 && (
				<details class="blog-show-all">
					<summary>Show all {blogs.length} posts</summary>
					<ul class="entry-list blog-compact">
						{blogs.slice(15).map((item) => (
							<li class="entry-compact">
								<a href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
									{item.metadata.title}
								</a>
								<span class="entry-meta">{formatSummaryDate(item.metadata.date)}</span>
							</li>
						))}
					</ul>
				</details>
			)}
		</section>

		<section id="talks" class="tab-panel">
			<h2>Talks & Conversations</h2>
			<p class="section-subtitle">Invited talks, panels, and podcasts.</p>
			{talksFilters.length > 0 && (
				<details class="filter-panel">
					<summary>Filter by venue</summary>
					<div class="filter-chips" data-filter-group="talks">
						<button type="button" class="chip active" data-filter-value="all">
							All ({talks.length})
						</button>
						{talksFilters.map((option) => (
							<button type="button" class="chip" data-filter-value={option.value}>
								{option.label} ({option.count})
							</button>
						))}
					</div>
				</details>
			)}
			<ul class="entry-list" data-filter-target="talks">
				{talks.map((item) => (
					<li
						class="entry"
						data-filter-value={(item.metadata.location ?? 'other').toString().toLowerCase()}
					>
						<h3>{item.metadata.title}</h3>
						<p>
							{formatSummaryDate(item.metadata.date)} ‚Äî {item.metadata.location}
							{talkTypes[String(item.metadata.type ?? '').toLowerCase()] &&
								` (${talkTypes[String(item.metadata.type ?? '').toLowerCase()]})`}
						</p>
						<div class="entry-links">
							{item.metadata.event_url && (
								<a class="chip-link" href={item.metadata.event_url as string} target="_blank" rel="noopener noreferrer">
									Event
								</a>
							)}
							{item.metadata.video_url && (
								<a class="chip-link" href={item.metadata.video_url as string} target="_blank" rel="noopener noreferrer">
									Recording
								</a>
							)}
						</div>
					</li>
				))}
			</ul>
		</section>

		<section id="media" class="tab-panel">
			<h2>Media Coverage</h2>
			<p class="section-subtitle">Select press, interviews, and commentary appearances.</p>
			{mediaFilters.length > 0 && (
				<details class="filter-panel">
					<summary>Filter by outlet</summary>
					<div class="filter-chips" data-filter-group="media">
						<button type="button" class="chip active" data-filter-value="all">
							All ({newsCoverage.length})
						</button>
						{mediaFilters.map((option) => (
							<button type="button" class="chip" data-filter-value={option.value}>
								{option.label} ({option.count})
							</button>
						))}
					</div>
				</details>
			)}
			<ul class="entry-list" data-filter-target="media">
				{newsCoverage.map((item) => (
					<li
						class="entry"
						data-filter-value={(item.metadata.source ?? 'other').toString().toLowerCase()}
					>
						<h3>{item.metadata.title}</h3>
						<p>
							{item.metadata.source}
							{Array.isArray(item.metadata.authors) && item.metadata.authors.length
								? `, ${item.metadata.authors.join(', ')}`
								: ''}
							, {formatSummaryDate(item.metadata.date)}
							{item.metadata.url && (
								<span class="entry-links">
									<a class="chip-link" href={item.metadata.url as string} target="_blank" rel="noopener noreferrer">
										Article link
									</a>
								</span>
							)}
						</p>
					</li>
				))}
			</ul>
		</section>
	</section>

	<footer>
		<p>&copy; {heroName}. All rights reserved.</p>
	</footer>

	<!-- Bio Modal -->
	<div id="bio-modal" class="modal" aria-hidden="true">
		<div class="modal-backdrop" data-modal-close></div>
		<div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="bio-modal-title">
			<button type="button" class="modal-close" data-modal-close aria-label="Close modal">&times;</button>
			<h3 id="bio-modal-title">Extended Bio</h3>
			<div class="modal-actions modal-actions-top">
				<button type="button" class="hero-btn secondary hero-btn-small copy-bio-btn" data-copy-target="bio-text-content">
					Copy bio
				</button>
				{profilePic && (
					<a class="hero-btn secondary hero-btn-small" href={profilePic} target="_blank" rel="noopener noreferrer">
						Download headshot
					</a>
				)}
			</div>
			<div class="bio-text" id="bio-text-content">
				{String(personalInfo.additional_background ?? '').split(/\n\s*\n/).map((para) => (
					<p>{para.trim()}</p>
				))}
			</div>
		</div>
	</div>

	<!-- Links Modal -->
	<div id="links-modal" class="modal" aria-hidden="true">
		<div class="modal-backdrop" data-modal-close></div>
		<div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="links-modal-title">
			<button type="button" class="modal-close" data-modal-close aria-label="Close modal">&times;</button>
			<h3 id="links-modal-title">All Links</h3>
			<div class="links-modal-grid">
				<div class="links-modal-section">
					<h4>Social</h4>
					<ul class="links-list">
						{socialLinks.map((item) => (
							<li>
								<a href={item.href as string} target="_blank" rel="noopener noreferrer">{item.label}</a>
							</li>
						))}
					</ul>
				</div>
				<div class="links-modal-section">
					<h4>Papers</h4>
					<ul class="links-list">
						{paperLinks.map((item) => (
							<li>
								<a href={item.href as string} target="_blank" rel="noopener noreferrer">{item.label}</a>
							</li>
						))}
					</ul>
				</div>
			</div>
		</div>
	</div>

	<script>
		const tabIds = ['publications', 'writing', 'blogs', 'talks', 'media'];

		const activateTab = (targetId) => {
			const cleaned = targetId.replace('#', '');
			const activeId = tabIds.includes(cleaned) ? cleaned : tabIds[0];

			tabIds.forEach((tab) => {
				const panel = document.getElementById(tab);
				if (panel) {
					panel.classList.toggle('is-active', tab === activeId);
				}
				const link = document.querySelector(`.section-nav a[href="#${tab}"]`);
				if (link) {
					link.classList.toggle('active', tab === activeId);
				}
			});
		};

		const setupFilters = () => {
			document.querySelectorAll('[data-filter-group]').forEach((group) => {
				const targetName = group.getAttribute('data-filter-group');
				if (!targetName) return;
				const targetList = document.querySelector(`[data-filter-target="${targetName}"]`);
				if (!targetList) return;

				group.addEventListener('click', (event) => {
					const target = event.target;
					if (!(target instanceof Element)) return;
					const button = target.closest('button[data-filter-value]');
					if (!button) return;
					const value = button.getAttribute('data-filter-value') || 'all';

					group.querySelectorAll('button[data-filter-value]').forEach((chip) => {
						chip.classList.toggle('active', chip === button);
					});

					targetList.querySelectorAll('[data-filter-value]').forEach((item) => {
						const matches = value === 'all' || item.getAttribute('data-filter-value') === value;
						item.hidden = !matches;
					});
				});
			});
		};

		// Modal functionality
		const openModal = (modalId) => {
			const modal = document.getElementById(modalId);
			if (modal) {
				modal.setAttribute('aria-hidden', 'false');
				modal.classList.add('is-open');
				document.body.style.overflow = 'hidden';
				// Focus the close button
				const closeBtn = modal.querySelector('.modal-close');
				if (closeBtn) closeBtn.focus();
			}
		};

		const closeModal = (modal) => {
			modal.setAttribute('aria-hidden', 'true');
			modal.classList.remove('is-open');
			document.body.style.overflow = '';
		};

		const closeAllModals = () => {
			document.querySelectorAll('.modal.is-open').forEach(closeModal);
		};

		const setupModals = () => {
			// Open modal triggers
			document.querySelectorAll('.modal-trigger').forEach((trigger) => {
				trigger.addEventListener('click', () => {
					const modalId = trigger.getAttribute('data-modal');
					if (modalId) openModal(modalId);
				});
			});

			// Close buttons and backdrop clicks
			document.querySelectorAll('[data-modal-close]').forEach((closer) => {
				closer.addEventListener('click', () => {
					const modal = closer.closest('.modal');
					if (modal) closeModal(modal);
				});
			});

			// Escape key closes modals
			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') closeAllModals();
			});

			// Copy bio button
			document.querySelectorAll('.copy-bio-btn').forEach((btn) => {
				btn.addEventListener('click', async () => {
					const targetId = btn.getAttribute('data-copy-target');
					const target = targetId ? document.getElementById(targetId) : null;
					if (!target) return;

					const text = target.innerText || target.textContent || '';
					try {
						await navigator.clipboard.writeText(text);
						const original = btn.textContent;
						btn.textContent = 'Copied!';
						btn.classList.add('copied');
						setTimeout(() => {
							btn.textContent = original;
							btn.classList.remove('copied');
						}, 2000);
					} catch (err) {
						console.error('Failed to copy:', err);
					}
				});
			});
		};

		// Theme toggle
		const setupThemeToggle = () => {
			const toggle = document.getElementById('theme-toggle');
			if (!toggle) return;

			const getPreferredTheme = () => {
				const stored = localStorage.getItem('theme');
				if (stored) return stored;
				return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			};

			const setTheme = (theme) => {
				document.documentElement.setAttribute('data-theme', theme);
				localStorage.setItem('theme', theme);
			};

			// Set initial theme
			setTheme(getPreferredTheme());

			toggle.addEventListener('click', () => {
				const current = document.documentElement.getAttribute('data-theme');
				setTheme(current === 'dark' ? 'light' : 'dark');
			});
		};

		// Run theme setup immediately to prevent flash
		setupThemeToggle();

		document.addEventListener('DOMContentLoaded', () => {
			activateTab(window.location.hash || tabIds[0]);
			setupFilters();
			setupModals();
		});

		window.addEventListener('hashchange', () => {
			activateTab(window.location.hash);
		});
	</script>
</Layout>

<style>
	/* Pacific Northwest Color Palette - Semantic tokens that swap in dark mode */
	:root {
		--color-primary: #0f5132;        /* Headings, primary links - deep pine green */
		--color-primary-hover: #083d24;  /* Hover states - shadowed forest */
		--color-secondary: #15803d;      /* Secondary links - forest green */
		--color-secondary-hover: #166534;
		--color-text: #1e293b;           /* Body text */
		--color-text-muted: #64748b;     /* Muted text */
		--color-bg: #ffffff;             /* Page background */
		--color-bg-card: #f1f5f9;        /* Card backgrounds */
		--color-bg-dark: #1e293b;        /* Dark sections (Recent Content) */
		--color-border: #e2e8f0;         /* Borders */
		--color-white: #ffffff;
	}

	:global([data-theme="dark"]) {
		--color-primary: #059669;        /* Deep emerald */
		--color-primary-hover: #10b981;  /* Lighter on hover */
		--color-secondary: #22c55e;      /* Bright forest green */
		--color-secondary-hover: #4ade80;
		--color-text: #e2e8f0;
		--color-text-muted: #94a3b8;
		--color-bg: #0f172a;
		--color-bg-card: #1e293b;
		--color-bg-dark: #0f172a;
		--color-border: #334155;
		--color-white: #ffffff;
	}

	body {
		background-color: var(--color-bg);
		color: var(--color-text);
	}

	header,
	section,
	footer {
		max-width: 1040px;
		margin: auto;
		padding: 1.5rem 1rem;
	}

	section {
		margin-bottom: 1rem;
	}

	h1,
	h2,
	h3 {
		margin: 0.5em 0;
		color: var(--color-primary);
	}

	h2 {
		font-size: 1.5rem;
		margin-top: 0;
		margin-bottom: 0.75rem;
		padding-bottom: 0.5rem;
		border-bottom: 2px solid var(--color-border);
	}

	/* Theme toggle button */
	.theme-toggle {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: transparent;
		border: 1px solid var(--color-border);
		border-radius: 8px;
		padding: 0.4rem 0.6rem;
		cursor: pointer;
		font-size: 1rem;
		line-height: 1;
		transition: background-color 0.2s, border-color 0.2s;
	}

	.theme-toggle:hover {
		background: rgba(15, 81, 50, 0.1);
		border-color: var(--color-primary);
	}

	.theme-icon-dark {
		display: none;
	}

	:global([data-theme="dark"]) .theme-icon-light {
		display: none;
	}

	:global([data-theme="dark"]) .theme-icon-dark {
		display: inline;
	}

.hero-manuscript {
	position: relative;
	padding-bottom: 1.5rem;
	border-bottom: 1px solid rgba(15, 23, 42, 0.08);
	max-width: 1100px;
	margin: 0 auto;
}

.hero-intro {
	text-align: center;
	max-width: 760px;
	margin: 0 auto 1rem;
}

.hero-heading {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 1rem;
	flex-wrap: wrap;
	margin-bottom: 0.5rem;
}

.hero-text {
	text-align: center;
	max-width: 800px;
}

.hero-name-row {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: 0.75rem;
	flex-wrap: wrap;
}

.hero-inline-pic {
	width: 64px;
	height: 64px;
	object-fit: cover;
	border-radius: 50%;
	box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18);
}

.hero-bio-block {
	text-align: left;
	margin: 0 auto 0.5rem;
}

.hero-bio {
	margin-bottom: 0.35rem;
}

.hero-cta {
	display: flex;
	justify-content: center;
	gap: 0.75rem;
	flex-wrap: wrap;
	margin-bottom: 0.5rem;
}

.hero-btn {
	padding: 0.3rem 0.75rem;
	border-radius: 999px;
	border: 1px solid var(--color-primary);
	background: var(--color-primary);
	color: var(--color-white);
	font-size: 0.85em;
	letter-spacing: 0.04em;
	text-transform: uppercase;
	cursor: pointer;
	transition: background 0.2s ease, color 0.2s ease;
}

.hero-btn:hover {
	background: var(--color-primary-hover);
}

.hero-btn.secondary {
	background: transparent;
	color: var(--color-primary);
}

.hero-btn.secondary:hover {
	background: rgba(46, 139, 87, 0.1);
}

.hero-btn:focus-visible {
	outline: 2px solid var(--color-primary);
	outline-offset: 2px;
}

.hero-btn-small {
	font-size: 0.75em;
	letter-spacing: 0.06em;
}

.hero-btn-email {
	font-family: 'IBM Plex Mono', monospace;
}


.hero-role {
	margin: 0.35rem 0 0;
	color: var(--color-text-muted);
}

.hero-research {
	margin: 0.25rem 0 0;
	color: var(--color-text-muted);
	font-size: 0.95em;
}

.hero-manuscript a {
	color: var(--color-primary);
	text-decoration: none;
}

.hero-manuscript a:hover {
	text-decoration: underline;
}


.hero-table {
	width: 100%;
	max-width: 1040px;
	margin: 0 auto 1rem;
	padding: 0;
}

.table-grid {
	display: grid;
	grid-template-columns: repeat(2, minmax(0, 1fr));
	padding: 0;
	margin: 0;
	list-style: none;
	gap: 0.75rem 1rem;
}

.table-row {
	display: grid;
	grid-template-columns: 110px 1fr;
	align-items: center;
	gap: 0.4rem;
	padding: 0.25rem 0;
	border-bottom: 1px solid rgba(15, 23, 42, 0.08);
}

.table-label {
	font-family: 'Crimson Pro', serif;
	font-size: 0.85em;
	letter-spacing: 0.08em;
	text-transform: uppercase;
	color: var(--color-text-muted);
}

.table-value {
	text-align: left;
}

/* Affiliation styling */
.affiliation-line a.primary {
	font-weight: 600;
}

.affiliation-line a.secondary {
	color: var(--color-text-muted);
}

/* Social icons */
.social-icons {
	display: flex;
	gap: 0.75rem;
	align-items: center;
}

.social-link {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	color: var(--color-primary);
	transition: color 0.2s, transform 0.2s;
}

.social-link:hover {
	color: var(--color-primary-hover);
	transform: scale(1.15);
}

.social-icon {
	width: 20px;
	height: 20px;
}

.text-link {
	color: var(--color-primary);
	text-decoration: none;
	font-size: 0.9rem;
	padding: 0.15rem 0.4rem;
	border: 1px solid var(--color-border);
	border-radius: 4px;
	transition: background-color 0.2s, border-color 0.2s;
}

.text-link:hover {
	background-color: var(--color-bg-card);
	border-color: var(--color-primary);
}

/* Links cell with expandable */
.links-cell {
	display: flex;
	flex-direction: column;
	gap: 0.5rem;
}

.links-expand {
	font-size: 0.85em;
}

.links-expand summary {
	cursor: pointer;
	color: var(--color-primary);
	font-weight: 500;
}

.links-expand summary:hover {
	text-decoration: underline;
}

.links-list {
	list-style: none;
	margin: 0.5rem 0 0;
	padding: 0;
	font-family: 'IBM Plex Mono', monospace;
	font-size: 0.9em;
}

.links-list li {
	padding: 0.2rem 0;
}

.links-list a {
	color: var(--color-secondary);
	text-decoration: none;
}

.links-list a:hover {
	color: var(--color-secondary-hover);
	text-decoration: underline;
}

@media (max-width: 720px) {
	.hero-intro {
		margin: 0 auto 1rem;
	}

	.hero-heading {
		flex-direction: column;
	}

	.hero-text {
		text-align: center;
	}

	.table-grid {
		grid-template-columns: 1fr;
	}
}

	#featured-links {
		max-width: 900px;
		margin: 0 auto 1.5rem;
		padding: 0 1rem;
	}

	.featured-list {
		list-style: disc;
		padding-left: 1.5rem;
		margin: 0;
		font-size: 1rem;
		line-height: 1.6;
	}

	.featured-list li {
		margin-bottom: 0.5rem;
	}

	.featured-list a {
		color: var(--color-primary);
		text-decoration: none;
	}

	.featured-list a:hover {
		color: var(--color-primary-hover);
		text-decoration: underline;
	}

	#recent-summary {
		text-align: center;
		width: 100%;
		background-color: var(--color-bg-dark);
		color: var(--color-white);
		padding: 1.3rem;
		border-radius: 10px;
		box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
	}

	#recent-summary h2,
	#recent-summary h3 {
		color: var(--color-white);
	}

	#recent-summary a {
		color: var(--color-secondary);
	}

	#recent-summary .grid {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		gap: 1rem;
	}

	.centered-summary {
		padding: 0.5em;
		width: 100%;
		box-sizing: border-box;
	}

	.summary-item {
		font-size: 0.9em;
		line-height: 1.3;
		text-align: left;
	}

	#status-board {
		background: var(--color-bg-card);
		color: var(--color-text);
		padding: 2rem;
		border-radius: 14px;
		box-shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
		text-align: left;
	}

	.status-header {
		margin-bottom: 1rem;
	}

	.status-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
		gap: 1rem;
	}

	.status-card {
		background: var(--color-white);
		border-radius: 10px;
		padding: 1rem;
		box-shadow: inset 0 0 0 1px var(--color-border);
		font-size: 0.95em;
		line-height: 1.5;
	}

	.status-empty {
		margin: 0;
		color: var(--color-text-muted);
	}

	.section-nav {
		display: flex;
		justify-content: center;
		flex-wrap: wrap;
		gap: 0.75rem;
		padding: 1rem 0;
		border-bottom: 2px solid var(--color-border);
		margin-bottom: 1rem;
	}

	.section-nav a {
		text-decoration: none;
		padding: 0.4em 0.9em;
		border: 1px solid transparent;
		border-radius: 4px;
		color: var(--color-secondary);
	}

	.section-nav a:hover,
	.section-nav a.active {
		border-color: var(--color-primary);
		color: var(--color-primary);
	}

	.tab-panel {
		display: none;
		background: var(--color-white);
		border-left: 4px solid var(--color-primary);
		padding: 1.75rem 1.75rem 1rem;
		margin-bottom: 2.5rem;
		border-radius: 0 10px 10px 0;
		box-shadow: 0 8px 30px rgba(15, 23, 42, 0.06);
	}

	.tab-panel.is-active {
		display: block;
	}

	.filter-chips {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		margin: 0.5rem 0 1rem;
	}

	.filter-panel {
		background: var(--color-bg-card);
		border: 1px solid var(--color-text);
		border-radius: 8px;
		padding: 0.5rem 0.75rem;
		margin-bottom: 0.5rem;
	}

	.filter-panel summary {
		cursor: pointer;
		font-weight: 600;
		color: var(--color-primary);
	}

	.filter-panel[open] {
		padding-bottom: 0.75rem;
	}

	.chip {
		border: 1px solid var(--color-border);
		background: var(--color-white);
		border-radius: 999px;
		padding: 0.2em 0.9em;
		font-size: 0.85em;
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.chip.active {
		background: var(--color-primary);
		border-color: var(--color-primary);
		color: var(--color-white);
	}

	.chip-link {
		display: inline-flex;
		align-items: center;
		padding: 0.2em 0.8em;
		border-radius: 999px;
		border: 1px solid var(--color-border);
		font-size: 0.85em;
		text-transform: uppercase;
		letter-spacing: 0.03em;
		text-decoration: none;
		color: var(--color-secondary);
		margin-right: 0.35rem;
	}

	.chip-link:hover {
		background: var(--color-secondary-hover);
		color: var(--color-white);
		border-color: var(--color-secondary-hover);
	}

	.section-subtitle {
		color: var(--color-text-muted);
		margin-top: -0.35rem;
		margin-bottom: 1.3rem;
		font-size: 0.95em;
	}

	.cta-row {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	.cta-link {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		padding: 0.28em 0.95em;
		border-radius: 999px;
		text-decoration: none;
		font-size: 0.88em;
		border: 1px solid var(--color-primary);
		color: var(--color-primary);
		background: transparent;
	}

	.cta-link:hover {
		background: var(--color-primary);
		color: var(--color-white);
	}

	.cta-link.muted {
		background: transparent;
		color: var(--color-primary);
	}

	.tab-panel {
		display: none;
	}

	.tab-panel.is-active {
		display: block;
	}

	.row {
		display: flex;
		gap: 1rem;
		margin: 0 auto;
	}

	.col {
		flex: 1;
	}

	.entry-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

.entry {
	padding: 1rem 1rem 1rem 1.25rem;
	border-bottom: none;
	margin-bottom: 0.75rem;
	text-align: left;
	background: var(--color-bg-card);
	border-left: 3px solid var(--color-border);
	border-radius: 0 6px 6px 0;
	transition: border-color 0.2s, background 0.2s;
}

.entry:hover {
	border-left-color: var(--color-primary);
	background: var(--color-bg-card);
}

.entry:last-child {
	margin-bottom: 0;
}

.entry-links {
	display: flex;
	flex-wrap: wrap;
	gap: 0.4rem;
	margin: 0.5rem 0 0;
}

	/* Summary subsections */
	.summary-subsection {
		margin-bottom: 0.75rem;
	}

	.summary-subsection:last-child {
		margin-bottom: 0;
	}

	.summary-label {
		display: block;
		font-size: 0.75em;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		color: var(--color-secondary);
		margin-bottom: 0.35rem;
		font-weight: 600;
	}

	/* Compact blog entries */
	.blog-summary {
		color: var(--color-text-muted);
		margin-bottom: 1rem;
		font-size: 0.95em;
	}

	.blog-compact {
		display: flex;
		flex-direction: column;
		gap: 0.35rem;
	}

	.blog-expandable {
		background: transparent;
		border: none;
	}

	.blog-expandable summary {
		cursor: pointer;
		list-style: none;
	}

	.blog-expandable summary::-webkit-details-marker {
		display: none;
	}

	.blog-header {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.blog-header h3 {
		margin: 0;
	}

	.blog-header::after {
		content: '‚ñº';
		font-size: 0.7em;
		color: var(--color-text-muted);
		transition: transform 0.2s;
	}

	.blog-expandable[open] .blog-header::after {
		transform: rotate(180deg);
	}

	.blog-show-all {
		margin-top: 0.75rem;
		padding-top: 0.5rem;
		border-top: 1px dashed var(--color-text);
	}

	.blog-show-all summary {
		cursor: pointer;
		color: var(--color-primary);
		font-size: 0.9em;
		font-weight: 500;
	}

	.blog-show-all summary:hover {
		text-decoration: underline;
	}

	.entry-compact {
		display: flex;
		justify-content: space-between;
		align-items: baseline;
		gap: 0.75rem;
		padding: 0.4rem 0.6rem;
		background: var(--color-bg-card);
		border-radius: 4px;
		font-size: 0.9em;
	}

	.entry-compact a {
		color: var(--color-primary);
		text-decoration: none;
		flex: 1;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.entry-compact a:hover {
		text-decoration: underline;
	}

	.entry-meta {
		color: var(--color-text-muted);
		font-size: 0.85em;
		white-space: nowrap;
	}

	.blog-more {
		margin-top: 0.75rem;
		font-size: 0.9em;
	}

	.blog-more a {
		color: var(--color-primary);
	}

	.quick-bio {
		margin-top: 1rem;
	}

	.profile-pic {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		object-fit: cover;
	}

	a:focus,
	button:focus,
	input:focus,
	select:focus {
		outline: 2px solid var(--color-secondary);
		outline-offset: 2px;
	}

	@media (max-width: 800px) {
		.table-grid {
			grid-template-columns: 1fr;
		}

		.table-row {
			grid-template-columns: 1fr;
		}
	}

	@media (max-width: 768px) {
		.row {
			flex-direction: column;
		}

		#recent-summary .grid {
			grid-template-columns: 1fr;
		}

		.section-nav {
			flex-direction: column;
			align-items: stretch;
		}
	}

	/* Dark mode styles - applied via data-theme attribute */
	:global([data-theme="dark"]) body {
		background-color: var(--color-bg);
		color: var(--color-text);
	}

	:global([data-theme="dark"]) h1,
	:global([data-theme="dark"]) h2,
	:global([data-theme="dark"]) h3 {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) h2 {
		border-bottom-color: var(--color-border);
	}

	:global([data-theme="dark"]) .featured-list a {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .featured-list a:hover {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .section-nav a {
		color: var(--color-secondary);
	}

	:global([data-theme="dark"]) .section-nav a:hover {
		color: var(--color-primary);
		border-color: var(--color-primary);
	}

	:global([data-theme="dark"]) .chip {
		background: var(--color-bg);
		color: var(--color-text);
		border-color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .chip.active {
		background: var(--color-primary);
		color: var(--color-bg);
		border-color: var(--color-primary);
	}

	:global([data-theme="dark"]) .filter-panel {
		background: var(--color-bg-card);
		border-color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) #status-board {
		background: var(--color-bg-card);
		color: var(--color-text);
		box-shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
	}

	:global([data-theme="dark"]) .status-card {
		background: var(--color-bg-card);
		box-shadow: inset 0 0 0 1px var(--color-border);
	}

	:global([data-theme="dark"]) .cta-link.ghost {
		color: var(--color-secondary);
		border-color: var(--color-secondary);
	}

	:global([data-theme="dark"]) .tab-panel {
		background: var(--color-bg-card);
		box-shadow: 0 25px 45px rgba(0, 0, 0, 0.35);
	}

	:global([data-theme="dark"]) .table-row {
		border-color: var(--color-border);
	}

	/* Social icons dark mode */
	:global([data-theme="dark"]) .social-link {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .social-link:hover {
		color: var(--color-secondary);
	}

	:global([data-theme="dark"]) .text-link {
		color: var(--color-primary);
		border-color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .text-link:hover {
		background-color: var(--color-bg-card);
		border-color: var(--color-primary);
	}

	:global([data-theme="dark"]) .affiliation-line a.secondary {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .links-expand summary {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .links-list a {
		color: var(--color-secondary);
	}

	:global([data-theme="dark"]) .links-list a:hover {
		color: var(--color-primary);
	}

	/* Entry cards dark mode */
	:global([data-theme="dark"]) .entry {
		background: var(--color-bg-card);
		border-left-color: var(--color-border);
	}

	:global([data-theme="dark"]) .entry:hover {
		background: var(--color-bg-card);
		border-left-color: var(--color-primary);
	}

	:global([data-theme="dark"]) .entry h3 {
		color: var(--color-text);
	}

	:global([data-theme="dark"]) .entry p {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .chip-link {
		color: var(--color-primary);
		border-color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .chip-link:hover {
		background: var(--color-primary-hover);
		color: var(--color-bg);
		border-color: var(--color-primary-hover);
	}

	/* Compact blog dark mode */
	:global([data-theme="dark"]) .blog-summary {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .entry-compact {
		background: var(--color-bg-card);
	}

	:global([data-theme="dark"]) .entry-compact a {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .entry-meta {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .blog-more a {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .blog-header::after {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .blog-show-all {
		border-top-color: var(--color-border);
	}

	:global([data-theme="dark"]) .blog-show-all summary {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .summary-label {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .theme-toggle {
		border-color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .theme-toggle:hover {
		background: rgba(5, 150, 105, 0.15);
		border-color: var(--color-primary);
	}

	/* Modal styles */
	.modal {
		display: none;
		position: fixed;
		inset: 0;
		z-index: 1000;
		align-items: center;
		justify-content: center;
	}

	.modal.is-open {
		display: flex;
	}

	.modal-backdrop {
		position: absolute;
		inset: 0;
		background: rgba(0, 0, 0, 0.5);
		cursor: pointer;
	}

	.modal-content {
		position: relative;
		background: var(--color-white);
		border-radius: 12px;
		padding: 1.5rem 2rem;
		max-width: 560px;
		width: 90%;
		max-height: 85vh;
		overflow-y: auto;
		box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25);
		animation: modalIn 0.2s ease-out;
	}

	@keyframes modalIn {
		from {
			opacity: 0;
			transform: scale(0.95) translateY(-10px);
		}
		to {
			opacity: 1;
			transform: scale(1) translateY(0);
		}
	}

	.modal-close {
		position: absolute;
		top: 0.75rem;
		right: 0.75rem;
		background: none;
		border: none;
		font-size: 1.5rem;
		cursor: pointer;
		color: var(--color-text-muted);
		line-height: 1;
		padding: 0.25rem;
		transition: color 0.2s;
	}

	.modal-close:hover {
		color: var(--color-text);
	}

	.modal-content h3 {
		margin: 0 0 1rem;
		font-size: 1.25rem;
		color: var(--color-primary);
	}

	.modal-content h4 {
		margin: 0 0 0.5rem;
		font-size: 0.9rem;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		color: var(--color-text-muted);
	}

	.modal-content p {
		margin: 0 0 1rem;
		line-height: 1.6;
	}

	.modal-actions {
		display: flex;
		gap: 0.75rem;
		flex-wrap: wrap;
		margin-top: 1rem;
		padding-top: 1rem;
		border-top: 1px solid var(--color-text);
	}

	.modal-actions-top {
		margin-top: 0;
		margin-bottom: 1rem;
		padding-top: 0;
		padding-bottom: 1rem;
		border-top: none;
		border-bottom: 1px solid var(--color-text);
	}

	.bio-text {
		line-height: 1.7;
	}

	.bio-text p {
		margin: 0 0 1rem;
	}

	.bio-text p:last-child {
		margin-bottom: 0;
	}

	.copy-bio-btn {
		cursor: pointer;
	}

	.copy-bio-btn.copied {
		background: var(--color-primary);
		color: var(--color-white);
		border-color: var(--color-primary);
	}

	.links-modal-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1.5rem;
	}

	.links-modal-section .links-list {
		margin: 0;
		padding: 0;
		list-style: none;
	}

	.links-modal-section .links-list li {
		padding: 0.35rem 0;
	}

	.links-modal-section .links-list a {
		color: var(--color-secondary);
		text-decoration: none;
	}

	.links-modal-section .links-list a:hover {
		color: var(--color-secondary-hover);
		text-decoration: underline;
	}

	/* Modal trigger buttons */
	.modal-trigger {
		background: none;
		border: none;
		color: var(--color-secondary);
		cursor: pointer;
		font-weight: 600;
		font-size: inherit;
		font-family: inherit;
		padding: 0;
	}

	.modal-trigger:hover {
		color: var(--color-secondary-hover);
		text-decoration: underline;
	}

	.bio-trigger {
		margin-left: 0.35rem;
	}

	/* Dark mode modal */
	:global([data-theme="dark"]) .modal-backdrop {
		background: rgba(0, 0, 0, 0.7);
	}

	:global([data-theme="dark"]) .modal-content {
		background: var(--color-bg-card);
		color: var(--color-text);
	}

	:global([data-theme="dark"]) .modal-close {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .modal-close:hover {
		color: var(--color-text);
	}

	:global([data-theme="dark"]) .modal-content h3 {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .modal-content h4 {
		color: var(--color-text-muted);
	}

	:global([data-theme="dark"]) .modal-actions {
		border-top-color: var(--color-border);
	}

	:global([data-theme="dark"]) .modal-actions-top {
		border-bottom-color: var(--color-border);
	}

	:global([data-theme="dark"]) .links-modal-section .links-list a {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .links-modal-section .links-list a:hover {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .modal-trigger {
		color: var(--color-primary);
	}

	:global([data-theme="dark"]) .copy-bio-btn.copied {
		background: var(--color-primary-hover);
		color: var(--color-bg);
		border-color: var(--color-primary-hover);
	}

	/* Reduced motion for accessibility */
	@media (prefers-reduced-motion: reduce) {
		*,
		*::before,
		*::after {
			animation-duration: 0.01ms !important;
			animation-iteration-count: 1 !important;
			transition-duration: 0.01ms !important;
		}

		.modal-content {
			animation: none;
		}

		.social-link:hover {
			transform: none;
		}
	}

	/* Print styles */
	@media print {
		body {
			background: white;
			color: black;
			font-size: 12pt;
		}

		.theme-toggle,
		.section-nav,
		.filter-panel,
		.modal,
		.skip-link,
		footer {
			display: none !important;
		}

		#recent-summary {
			background: #f0f0f0 !important;
			color: black !important;
			box-shadow: none;
			border: 1px solid #ccc;
		}

		#recent-summary h2,
		#recent-summary h3 {
			color: black !important;
		}

		#recent-summary a {
			color: #333 !important;
		}

		.tab-panel {
			display: block !important;
			box-shadow: none;
			border: 1px solid #ccc;
			page-break-inside: avoid;
		}

		a {
			color: #333;
			text-decoration: underline;
		}

		a[href^="http"]::after {
			content: " (" attr(href) ")";
			font-size: 0.8em;
			color: #666;
		}

		h1, h2, h3 {
			color: black;
			page-break-after: avoid;
		}

		.entry {
			background: white;
			border-left-color: #999;
			page-break-inside: avoid;
		}
	}
</style>
